<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Uploader</title>
    <link rel="stylesheet" href="css/main.css" />
    <link rel="stylesheet" href="css/alert.css">
  </head>
  <body>
    <div class="container">
      <div class="upload-area" id="dropZone">
        <div class="upload-content">
          <div class="upload-icon">⬆️</div>
          <h2>Drag and drop your files here</h2>
          <p>Files supported: JPG, PNG, GIF</p>
          <p class="or">or</p>
          <button class="browse-btn">Browse files</button>
          <input type="file" hidden id="fileInput"  />
          <p class="file-limit">Maximum size: 2Mb</p>
        </div>
      </div>
      <div class="email-input-section">
        <label for="email">Enter recipient's email address:</label>
        <input type="email" id="emailInput" placeholder="Recipient's email" required />
      </div>
      <div class="files-list">
        <h3>Files</h3>
        <div id="filesList"></div>
      </div>
      <div class="files-list">
        <button type="button" class="browse-btn" id="btn">Upload</button>
      </div>
    </div>
        <!-- Custom Alert UI -->
        <div id="alertOverlay" class="alert-overlay">
            <div class="alert-box">
                <h2 id="alertTitle">Welcome back</h2>
                <p id="alertMessage">This is a custom alert message</p>
                <button id="closeAlert" class="close-btn">Close</button>
            </div>
        </div>
    <script type="module" src="js/upload.js"></script>
    <script src="js/alert.js"></script>
    <script src="js/main.js"></script>
    <script>

document.querySelector('#btn').addEventListener('click', async (event) => {
    event.preventDefault();

    const formdata = new FormData();
    const file = document.getElementById('fileInput').files[0];
    const email = document.getElementById('emailInput').value;

    if (!file) {
        console.log('No file found');
    } else {
        console.log('File found', file);
        console.log('File size (in bytes):', file.size);  // Log the file size
    }

    formdata.append('file', file);
    formdata.append('email', email);

    const token = localStorage.getItem('authtoken');

    if (!token) {
        alert('You must be logged in to upload a file');
        return;
    }

    try {
        const response = await fetch('https://fileo-backend.onrender.com/upload', {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`,
            },
            body: formdata,
        });
        const result = await response.json();
        showAlert(result.message);

    } catch (err) {
        console.error('Error: ', err);
        showAlert('Error uploading file!');
    }
});

    </script>
  </body>
</html>
